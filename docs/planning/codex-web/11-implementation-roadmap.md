# 实施路线图

**文档版本**: v1.0  
**最后更新**: 2025-09-11  
**依赖文档**: [01-requirements.md](01-requirements.md), [02-architecture.md](02-architecture.md)

## 里程碑规划

### M1: 基础服务 (2-3 周)
**目标**: Web 服务基础框架和健康检查

**关键成果**:
- [x] codex-web crate 结构搭建
- [x] Axum 服务器启动和基础路由
- [x] CLI `codex web` 子命令
- [x] 静态资源服务
- [x] 健康检查端点
- [x] 基础错误处理
- [x] 自动打开浏览器功能

**验收标准**:
- `codex web` 能启动服务并打开浏览器
- `/api/health` 返回正常状态
- 静态文件能正常访问

### M2: 会话流通 (3-4 周) 
**目标**: 基础会话创建和消息流

**关键成果**:
- [x] SessionRegistry 和 Session 实现
- [x] 与 ConversationManager 集成
- [x] WebSocket 连接处理
- [x] 基础事件流 (Event -> WebSocket)
- [x] 前端 React 应用框架
- [x] 简单的聊天界面
- [x] 类型生成工具集成

**验收标准**:
- 能创建会话并建立 WebSocket 连接
- 用户输入能触发对话流
- 前端能实时显示 AI 回复

### M3: 审批与补丁 (2-3 周)
**目标**: 核心交互功能完整

**关键成果**:
- [x] AskForApproval 事件处理
- [x] 审批 UI 组件和流程
- [x] 代码 diff 预览组件
- [x] 补丁应用 API 和 UI
- [x] ANSI 转 HTML 渲染
- [x] 语法高亮支持

**验收标准**:
- 审批提示能正确显示并响应用户操作
- 代码 diff 有清晰的可视化
- 补丁能一键应用

### M4: 历史与恢复 (2 周)
**目标**: 历史记录功能

**关键成果**:
- [x] 历史记录 API
- [x] 历史列表页面
- [x] 会话恢复功能
- [x] 事件缓存和重连恢复
- [x] 会话状态持久化

**验收标准**:
- 历史页面能显示过往会话
- 能从历史恢复会话状态
- 网络中断后能自动重连并恢复

### M5: 登录与信任 (2-3 周)
**目标**: 身份认证和项目信任

**关键成果**:
- [x] 登录状态 API 和 UI
- [x] OAuth 流程集成 (复用现有)
- [x] 项目信任状态 UI
- [x] 配置管理界面
- [x] 入门引导流程

**验收标准**:
- 登录流程在 Web 端正常工作
- 项目信任设置能可视化操作
- 新用户有清晰的入门指导

### M6: 打磨与发布 (3-4 周)
**目标**: 生产就绪

**关键成果**:
- [x] 全面错误处理和用户提示
- [x] 性能优化 (连接池、缓存等)
- [x] 响应式设计适配
- [x] 无障碍性改进
- [x] 完整测试覆盖
- [x] 文档和示例
- [x] CI/CD 集成
- [x] 发布脚本

**验收标准**:
- 所有核心功能稳定可用
- 性能指标达到要求
- 测试覆盖率 > 80%
- 通过 QA 验收测试

## 详细任务规划

### M1 任务分解
```
Week 1:
- [ ] 搭建 codex-web crate 基础结构
- [ ] 实现 Axum 服务器和基础中间件  
- [ ] 添加 CLI 子命令和参数解析
- [ ] 健康检查端点

Week 2-3:
- [ ] 静态资源服务 (开发/生产模式)
- [ ] 基础错误处理和日志
- [ ] 自动打开浏览器功能
- [ ] 基础安全设置 (CORS, 访问令牌)
- [ ] 集成测试和文档
```

### M2 任务分解  
```
Week 1:
- [ ] SessionRegistry 和 Session 数据结构
- [ ] 与 ConversationManager 集成
- [ ] 基础 WebSocket 处理

Week 2:  
- [ ] 事件流处理和广播
- [ ] 前端 Vite+React 项目搭建
- [ ] 类型生成集成

Week 3-4:
- [ ] 基础聊天 UI 组件
- [ ] WebSocket 客户端连接
- [ ] 消息渲染和输入处理
- [ ] 连接状态管理
```

## 风险缓解策略

### 技术风险
- **WebSocket 兼容性**: 提前准备 SSE 备选方案
- **类型同步**: 自动化类型生成和验证
- **性能瓶颈**: 分阶段性能测试和优化

### 集成风险  
- **现有系统破坏**: 严格的集成测试和回归测试
- **配置冲突**: 详细的配置隔离和验证
- **沙箱策略**: 早期验证和持续监控

### 时间风险
- **功能复杂度**: 保持 MVP 思维，非核心功能后置
- **测试时间**: 测试驱动开发，边开发边测试  
- **文档滞后**: 同步维护文档和代码

## 资源分配

### 开发资源
- **后端开发**: 2-3 人，主要负责 Rust 服务端
- **前端开发**: 1-2 人，React/TypeScript 界面
- **集成测试**: 1 人，端到端测试和 QA
- **文档维护**: 兼职，所有开发者参与

### 基础设施
- **开发环境**: 本地开发，Git 分支管理
- **测试环境**: CI/CD 自动化测试
- **文档平台**: Markdown + Git，便于版本控制

## 成功标准

### 功能标准
- [ ] 90% 的 TUI 核心功能在 Web 端可用
- [ ] 用户能无缝在 TUI 和 Web 间切换
- [ ] 所有主要用户场景能完整覆盖

### 性能标准  
- [ ] Web 服务启动时间 < 3 秒
- [ ] API 响应时间 < 200ms (95th percentile)
- [ ] WebSocket 消息延迟 < 100ms

### 质量标准
- [ ] 核心功能测试覆盖率 > 80%
- [ ] 零 Critical/High 级别未修复问题
- [ ] 内测用户满意度 > 80%

---
**变更记录**：
- v1.0 (2025-09-11): 初始版本，包含 6 个里程碑的详细规划