## 1. 核心原则
- **CRITICAL:** 你必须遵守一个不可违背的规则：**任何代码修改都必须伴随一个符合以下规范的注释。**
- **MUST NOT:** 输出任何未经注释的代码修改。

## 2. 注释规则 (Annotation Rules)
- **MUST:** 在执行任何代码修改前，先判断修改范围是“单行”还是“多行”，然后严格选择对应的规则。

### 规则 A: 单行修改 (Single-Line Modification)
- **适用场景:** 当修改仅影响代码中的单行时。
- **执行动作:**
  1.  在被修改行的**正上方**，添加一行注释。
  2.  注释格式必须为：`// !Modify: [遵循“内容指导原则”撰写说明]`
- **示例:**
  ```rust
  // ... original code ...
  // !Modify: 延长超时以兼容慢速网络
  const TIMEOUT = 10_000;
  // ... original code ...
  ```

### 规则 B: 多行/块级修改 (Multi-Line/Block Modification)
- **适用场景:** 当修改跨越多行、添加新函数/模块，或对一个逻辑块进行重构时。
- **执行动作:**
  1.  使用 `!Modify Start` 和 `!Modify End` 注释块，将整个修改区域**精确包裹**起来。
  2.  在 `Start` 块的**内部顶端**，必须包含 `!Desc` 和 `!AI_GUIDANCE` 两个元信息标签。
- **模板:**
  ```rust
  // ===== !Modify Start: [功能/修改点名称] =====
  // !Desc: [遵循“内容指导原则”撰写说明]
  // !AI_GUIDANCE: [为未来的代码合并提供指导，说明如何处理与上游更新的潜在冲突]

  // ... a block of modified or new code ...

  // ===== !Modify End: [功能/修改点名称] =====
  ```

## 3. 内容指导原则 (Content Guidance)
- **CRITICAL:** 你的注释质量取决于此。**注释的核心是解释“为什么改 (Why)”，而不是“改了什么 (What)”。**

### 指导 A: 简洁性优先
- **当代码意图明显时，注释必须极其简短。**
- **禁止**复述代码。
  - **错误示例:** `// !Modify: 设置 TIMEOUT 为 10_000` (这是复述)
  - **正确示例:** `// !Modify: 延长超时以兼容慢速网络` (这解释了意图)

### 指导 B: 上下文补充
- **当修改是某个复杂功能的一部分，或者其效果需要与其他地方的代码联动时，必须在 `!Desc` 中说明上下文。**
- **必须**解释清楚此修改在整个功能链路中的角色。
  - **正确示例:** `// !Desc: 实现用户认证流程的第二步：处理密码加密。此函数的结果将被传递给 api/auth.rs 中的 login_handler。`
  - **正确示例:** `// !Desc: 修复 issue #123 中提到的渲染 bug。通过提前检查数组边界，避免越界访问。`

### 指导 C: 总结
| **如果代码...** | **那么注释应该...** |
| :--- | :--- |
| **简单且自明** | **极其简短**，一句话点明**动机**。 |
| **复杂或依赖其他模块** | **提供必要的上下文**，说明它与其他部分的关系和**高级目标**。 |