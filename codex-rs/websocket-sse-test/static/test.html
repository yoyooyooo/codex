<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket vs SSE å…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .test-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .protocol-section {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        .protocol-section.websocket {
            border-color: #4CAF50;
        }
        .protocol-section.sse {
            border-color: #2196F3;
        }
        .protocol-section h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.connecting {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .controls {
            margin: 15px 0;
        }
        .controls button {
            margin: 5px;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-connect {
            background-color: #28a745;
            color: white;
        }
        .btn-disconnect {
            background-color: #dc3545;
            color: white;
        }
        .btn-test {
            background-color: #007bff;
            color: white;
        }
        .btn-clear {
            background-color: #6c757d;
            color: white;
        }
        .metrics {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #fafafa;
            font-family: monospace;
            font-size: 12px;
        }
        .message {
            margin: 2px 0;
            padding: 2px 5px;
        }
        .message.sent {
            background-color: #e3f2fd;
        }
        .message.received {
            background-color: #f3e5f5;
        }
        .message.error {
            background-color: #ffebee;
            color: #c62828;
        }
        .test-controls {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .environment-selector {
            margin: 20px 0;
            text-align: center;
        }
        .environment-selector select {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WebSocket vs SSE å…¼å®¹æ€§æµ‹è¯•</h1>
            <p>æµ‹è¯•ä¸åŒç½‘ç»œç¯å¢ƒä¸‹ WebSocket å’Œ Server-Sent Events çš„æ€§èƒ½ä¸å…¼å®¹æ€§</p>
        </div>

        <div class="environment-selector">
            <label for="environment">å½“å‰æµ‹è¯•ç¯å¢ƒï¼š</label>
            <select id="environment">
                <option value="direct">ç›´è¿</option>
                <option value="http-proxy">HTTP ä»£ç†</option>
                <option value="https-proxy">HTTPS ä»£ç†</option>
                <option value="firewall">é™åˆ¶æ€§é˜²ç«å¢™</option>
                <option value="unstable">ä¸ç¨³å®šç½‘ç»œ</option>
            </select>
        </div>

        <div class="test-panel">
            <div class="protocol-section websocket">
                <h3>ğŸ”Œ WebSocket</h3>
                <div id="ws-status" class="status disconnected">æœªè¿æ¥</div>
                <div class="controls">
                    <button class="btn-connect" onclick="connectWebSocket()">è¿æ¥</button>
                    <button class="btn-disconnect" onclick="disconnectWebSocket()">æ–­å¼€</button>
                    <button class="btn-test" onclick="sendWebSocketTest()">å‘é€æµ‹è¯•</button>
                    <button class="btn-clear" onclick="clearWebSocketMessages()">æ¸…ç©ºæ—¥å¿—</button>
                </div>
                <div class="metrics">
                    <h4>æ€§èƒ½æŒ‡æ ‡</h4>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <span>è¿æ¥æ—¶é•¿:</span>
                            <span id="ws-connection-time">-</span>
                        </div>
                        <div class="metric-item">
                            <span>å‘é€æ¶ˆæ¯:</span>
                            <span id="ws-sent-count">0</span>
                        </div>
                        <div class="metric-item">
                            <span>æ¥æ”¶æ¶ˆæ¯:</span>
                            <span id="ws-received-count">0</span>
                        </div>
                        <div class="metric-item">
                            <span>å¹³å‡å»¶è¿Ÿ:</span>
                            <span id="ws-avg-latency">-</span>
                        </div>
                        <div class="metric-item">
                            <span>è¿æ¥é”™è¯¯:</span>
                            <span id="ws-error-count">0</span>
                        </div>
                        <div class="metric-item">
                            <span>é‡è¿æ¬¡æ•°:</span>
                            <span id="ws-reconnect-count">0</span>
                        </div>
                    </div>
                </div>
                <div id="ws-messages" class="messages"></div>
            </div>

            <div class="protocol-section sse">
                <h3>ğŸ“¡ Server-Sent Events</h3>
                <div id="sse-status" class="status disconnected">æœªè¿æ¥</div>
                <div class="controls">
                    <button class="btn-connect" onclick="connectSSE()">è¿æ¥</button>
                    <button class="btn-disconnect" onclick="disconnectSSE()">æ–­å¼€</button>
                    <button class="btn-test" onclick="sendSSETest()">å‘é€æµ‹è¯•</button>
                    <button class="btn-clear" onclick="clearSSEMessages()">æ¸…ç©ºæ—¥å¿—</button>
                </div>
                <div class="metrics">
                    <h4>æ€§èƒ½æŒ‡æ ‡</h4>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <span>è¿æ¥æ—¶é•¿:</span>
                            <span id="sse-connection-time">-</span>
                        </div>
                        <div class="metric-item">
                            <span>å‘é€æ¶ˆæ¯:</span>
                            <span id="sse-sent-count">0</span>
                        </div>
                        <div class="metric-item">
                            <span>æ¥æ”¶æ¶ˆæ¯:</span>
                            <span id="sse-received-count">0</span>
                        </div>
                        <div class="metric-item">
                            <span>å¹³å‡å»¶è¿Ÿ:</span>
                            <span id="sse-avg-latency">-</span>
                        </div>
                        <div class="metric-item">
                            <span>è¿æ¥é”™è¯¯:</span>
                            <span id="sse-error-count">0</span>
                        </div>
                        <div class="metric-item">
                            <span>é‡è¿æ¬¡æ•°:</span>
                            <span id="sse-reconnect-count">0</span>
                        </div>
                    </div>
                </div>
                <div id="sse-messages" class="messages"></div>
            </div>
        </div>

        <div class="test-controls">
            <h3>æ‰¹é‡æµ‹è¯•æ§åˆ¶</h3>
            <button class="btn-test" onclick="runConnectionTest()">è¿æ¥ç¨³å®šæ€§æµ‹è¯•</button>
            <button class="btn-test" onclick="runLatencyTest()">å»¶è¿Ÿæ€§èƒ½æµ‹è¯•</button>
            <button class="btn-test" onclick="runThroughputTest()">ååé‡æµ‹è¯•</button>
            <button class="btn-test" onclick="runReconnectTest()">é‡è¿æœºåˆ¶æµ‹è¯•</button>
            <button class="btn-clear" onclick="resetAllTests()">é‡ç½®æ‰€æœ‰æµ‹è¯•</button>
        </div>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>æŒ‡æ ‡</th>
                    <th>WebSocket</th>
                    <th>SSE</th>
                    <th>ä¼˜åŠ¿æ–¹</th>
                </tr>
            </thead>
            <tbody id="comparison-results">
                <tr>
                    <td>è¿æ¥å»ºç«‹æ—¶é—´</td>
                    <td id="comparison-ws-connect">-</td>
                    <td id="comparison-sse-connect">-</td>
                    <td id="comparison-connect-winner">-</td>
                </tr>
                <tr>
                    <td>æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿ</td>
                    <td id="comparison-ws-latency">-</td>
                    <td id="comparison-sse-latency">-</td>
                    <td id="comparison-latency-winner">-</td>
                </tr>
                <tr>
                    <td>è¿æ¥ç¨³å®šæ€§</td>
                    <td id="comparison-ws-stability">-</td>
                    <td id="comparison-sse-stability">-</td>
                    <td id="comparison-stability-winner">-</td>
                </tr>
                <tr>
                    <td>é‡è¿æˆåŠŸç‡</td>
                    <td id="comparison-ws-reconnect">-</td>
                    <td id="comparison-sse-reconnect">-</td>
                    <td id="comparison-reconnect-winner">-</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let wsConnection = null;
        let sseConnection = null;
        let sessionId = generateSessionId();
        let wsStats = resetStats();
        let sseStats = resetStats();
        let wsConnectTime = null;
        let sseConnectTime = null;

        function generateSessionId() {
            return 'test-' + Math.random().toString(36).substr(2, 9);
        }

        function resetStats() {
            return {
                sent: 0,
                received: 0,
                errors: 0,
                reconnects: 0,
                latencies: [],
                connectTime: null
            };
        }

        function getCurrentEnvironment() {
            return document.getElementById('environment').value;
        }

        // WebSocket å‡½æ•°
        function connectWebSocket() {
            if (wsConnection && wsConnection.readyState === WebSocket.OPEN) {
                return;
            }

            const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${location.host}/ws?session_id=${sessionId}`;
            
            updateWSStatus('connecting', 'æ­£åœ¨è¿æ¥...');
            wsConnectTime = performance.now();
            
            wsConnection = new WebSocket(wsUrl);
            
            wsConnection.onopen = function(event) {
                const connectLatency = performance.now() - wsConnectTime;
                updateWSStatus('connected', `å·²è¿æ¥ (${connectLatency.toFixed(2)}ms)`);
                wsStats.connectTime = connectLatency;
                addWSMessage('system', `WebSocket è¿æ¥å»ºç«‹ï¼Œå»¶è¿Ÿ: ${connectLatency.toFixed(2)}ms`);
                updateWSMetrics();
            };

            wsConnection.onmessage = function(event) {
                try {
                    const message = JSON.parse(event.data);
                    const now = performance.now();
                    const latency = now - message.timestamp;
                    
                    wsStats.received++;
                    wsStats.latencies.push(latency);
                    
                    addWSMessage('received', `æ”¶åˆ°: ${message.content} (å»¶è¿Ÿ: ${latency.toFixed(2)}ms)`);
                    updateWSMetrics();
                } catch (e) {
                    addWSMessage('error', `æ¶ˆæ¯è§£æé”™è¯¯: ${e.message}`);
                    wsStats.errors++;
                    updateWSMetrics();
                }
            };

            wsConnection.onerror = function(event) {
                addWSMessage('error', 'WebSocket è¿æ¥é”™è¯¯');
                wsStats.errors++;
                updateWSMetrics();
            };

            wsConnection.onclose = function(event) {
                updateWSStatus('disconnected', 'è¿æ¥å·²å…³é—­');
                addWSMessage('system', `WebSocket è¿æ¥å…³é—­ (ä»£ç : ${event.code})`);
                
                // è‡ªåŠ¨é‡è¿é€»è¾‘
                if (!event.wasClean && wsStats.reconnects < 3) {
                    setTimeout(() => {
                        wsStats.reconnects++;
                        addWSMessage('system', `å°è¯•é‡è¿... (${wsStats.reconnects}/3)`);
                        connectWebSocket();
                    }, 2000 + wsStats.reconnects * 1000);
                }
            };
        }

        function disconnectWebSocket() {
            if (wsConnection) {
                wsConnection.close(1000, 'User initiated');
                wsConnection = null;
            }
        }

        function sendWebSocketTest() {
            if (!wsConnection || wsConnection.readyState !== WebSocket.OPEN) {
                addWSMessage('error', 'WebSocket æœªè¿æ¥');
                return;
            }

            const message = {
                id: generateSessionId(),
                timestamp: performance.now(),
                content: `æµ‹è¯•æ¶ˆæ¯ ${wsStats.sent + 1}`,
                message_type: 'Ping'
            };

            wsConnection.send(JSON.stringify(message));
            wsStats.sent++;
            addWSMessage('sent', `å‘é€: ${message.content}`);
            updateWSMetrics();
        }

        // SSE å‡½æ•°
        function connectSSE() {
            if (sseConnection) {
                disconnectSSE();
            }

            const sseUrl = `/sse?session_id=${sessionId}`;
            updateSSEStatus('connecting', 'æ­£åœ¨è¿æ¥...');
            sseConnectTime = performance.now();

            sseConnection = new EventSource(sseUrl);

            sseConnection.onopen = function(event) {
                const connectLatency = performance.now() - sseConnectTime;
                updateSSEStatus('connected', `å·²è¿æ¥ (${connectLatency.toFixed(2)}ms)`);
                sseStats.connectTime = connectLatency;
                addSSEMessage('system', `SSE è¿æ¥å»ºç«‹ï¼Œå»¶è¿Ÿ: ${connectLatency.toFixed(2)}ms`);
                updateSSEMetrics();
            };

            sseConnection.onmessage = function(event) {
                try {
                    const message = JSON.parse(event.data);
                    const now = performance.now();
                    const latency = now - message.timestamp;
                    
                    sseStats.received++;
                    sseStats.latencies.push(latency);
                    
                    addSSEMessage('received', `æ”¶åˆ°: ${message.content} (å»¶è¿Ÿ: ${latency.toFixed(2)}ms)`);
                    updateSSEMetrics();
                } catch (e) {
                    addSSEMessage('error', `æ¶ˆæ¯è§£æé”™è¯¯: ${e.message}`);
                    sseStats.errors++;
                    updateSSEMetrics();
                }
            };

            sseConnection.onerror = function(event) {
                addSSEMessage('error', 'SSE è¿æ¥é”™è¯¯');
                sseStats.errors++;
                updateSSEMetrics();
                
                // è‡ªåŠ¨é‡è¿é€»è¾‘
                if (sseStats.reconnects < 3) {
                    setTimeout(() => {
                        sseStats.reconnects++;
                        addSSEMessage('system', `å°è¯•é‡è¿... (${sseStats.reconnects}/3)`);
                        connectSSE();
                    }, 2000 + sseStats.reconnects * 1000);
                }
            };
        }

        function disconnectSSE() {
            if (sseConnection) {
                sseConnection.close();
                sseConnection = null;
                updateSSEStatus('disconnected', 'è¿æ¥å·²å…³é—­');
            }
        }

        async function sendSSETest() {
            const message = {
                message_type: 'Broadcast',
                content: `SSE æµ‹è¯•æ¶ˆæ¯ ${sseStats.sent + 1}`
            };

            try {
                const response = await fetch('/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(message)
                });

                const result = await response.json();
                if (result.status === 'success') {
                    sseStats.sent++;
                    addSSEMessage('sent', `å‘é€: ${message.content}`);
                    updateSSEMetrics();
                } else {
                    addSSEMessage('error', `å‘é€å¤±è´¥: ${result.error}`);
                    sseStats.errors++;
                }
            } catch (e) {
                addSSEMessage('error', `å‘é€é”™è¯¯: ${e.message}`);
                sseStats.errors++;
                updateSSEMetrics();
            }
        }

        // çŠ¶æ€æ›´æ–°å‡½æ•°
        function updateWSStatus(type, message) {
            const statusEl = document.getElementById('ws-status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        function updateSSEStatus(type, message) {
            const statusEl = document.getElementById('sse-status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        function updateWSMetrics() {
            document.getElementById('ws-connection-time').textContent = 
                wsStats.connectTime ? `${wsStats.connectTime.toFixed(2)}ms` : '-';
            document.getElementById('ws-sent-count').textContent = wsStats.sent;
            document.getElementById('ws-received-count').textContent = wsStats.received;
            document.getElementById('ws-avg-latency').textContent = 
                wsStats.latencies.length > 0 
                    ? `${(wsStats.latencies.reduce((a, b) => a + b, 0) / wsStats.latencies.length).toFixed(2)}ms`
                    : '-';
            document.getElementById('ws-error-count').textContent = wsStats.errors;
            document.getElementById('ws-reconnect-count').textContent = wsStats.reconnects;
        }

        function updateSSEMetrics() {
            document.getElementById('sse-connection-time').textContent = 
                sseStats.connectTime ? `${sseStats.connectTime.toFixed(2)}ms` : '-';
            document.getElementById('sse-sent-count').textContent = sseStats.sent;
            document.getElementById('sse-received-count').textContent = sseStats.received;
            document.getElementById('sse-avg-latency').textContent = 
                sseStats.latencies.length > 0 
                    ? `${(sseStats.latencies.reduce((a, b) => a + b, 0) / sseStats.latencies.length).toFixed(2)}ms`
                    : '-';
            document.getElementById('sse-error-count').textContent = sseStats.errors;
            document.getElementById('sse-reconnect-count').textContent = sseStats.reconnects;
        }

        // æ¶ˆæ¯æ˜¾ç¤ºå‡½æ•°
        function addWSMessage(type, message) {
            const messagesEl = document.getElementById('ws-messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            messagesEl.appendChild(messageEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function addSSEMessage(type, message) {
            const messagesEl = document.getElementById('sse-messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            messagesEl.appendChild(messageEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function clearWebSocketMessages() {
            document.getElementById('ws-messages').innerHTML = '';
        }

        function clearSSEMessages() {
            document.getElementById('sse-messages').innerHTML = '';
        }

        // æ‰¹é‡æµ‹è¯•å‡½æ•°
        async function runConnectionTest() {
            addWSMessage('system', 'å¼€å§‹è¿æ¥ç¨³å®šæ€§æµ‹è¯•...');
            addSSEMessage('system', 'å¼€å§‹è¿æ¥ç¨³å®šæ€§æµ‹è¯•...');
            
            // è¿ç»­è¿æ¥/æ–­å¼€æµ‹è¯•
            for (let i = 0; i < 5; i++) {
                connectWebSocket();
                connectSSE();
                await new Promise(resolve => setTimeout(resolve, 2000));
                disconnectWebSocket();
                disconnectSSE();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        async function runLatencyTest() {
            if (!wsConnection || !sseConnection) {
                alert('è¯·å…ˆå»ºç«‹ WebSocket å’Œ SSE è¿æ¥');
                return;
            }
            
            addWSMessage('system', 'å¼€å§‹å»¶è¿Ÿæµ‹è¯•...');
            addSSEMessage('system', 'å¼€å§‹å»¶è¿Ÿæµ‹è¯•...');
            
            // å‘é€ 20 æ¡æµ‹è¯•æ¶ˆæ¯
            for (let i = 0; i < 20; i++) {
                sendWebSocketTest();
                await sendSSETest();
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function runThroughputTest() {
            if (!wsConnection || !sseConnection) {
                alert('è¯·å…ˆå»ºç«‹ WebSocket å’Œ SSE è¿æ¥');
                return;
            }
            
            addWSMessage('system', 'å¼€å§‹ååé‡æµ‹è¯•...');
            addSSEMessage('system', 'å¼€å§‹ååé‡æµ‹è¯•...');
            
            // å¿«é€Ÿå‘é€å¤§é‡æ¶ˆæ¯
            const startTime = performance.now();
            for (let i = 0; i < 100; i++) {
                if (i % 2 === 0) {
                    sendWebSocketTest();
                } else {
                    await sendSSETest();
                }
            }
            const endTime = performance.now();
            
            addWSMessage('system', `ååé‡æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: ${(endTime - startTime).toFixed(2)}ms`);
            addSSEMessage('system', `ååé‡æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: ${(endTime - startTime).toFixed(2)}ms`);
        }

        async function runReconnectTest() {
            addWSMessage('system', 'å¼€å§‹é‡è¿æµ‹è¯•...');
            addSSEMessage('system', 'å¼€å§‹é‡è¿æµ‹è¯•...');
            
            // æ¨¡æ‹Ÿç½‘ç»œä¸­æ–­
            disconnectWebSocket();
            disconnectSSE();
            
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // å°è¯•é‡æ–°è¿æ¥
            connectWebSocket();
            connectSSE();
        }

        function resetAllTests() {
            wsStats = resetStats();
            sseStats = resetStats();
            clearWebSocketMessages();
            clearSSEMessages();
            updateWSMetrics();
            updateSSEMetrics();
            sessionId = generateSessionId();
        }

        // å®šæœŸæ›´æ–°æ¯”è¾ƒè¡¨
        setInterval(() => {
            if (wsStats.connectTime && sseStats.connectTime) {
                document.getElementById('comparison-ws-connect').textContent = `${wsStats.connectTime.toFixed(2)}ms`;
                document.getElementById('comparison-sse-connect').textContent = `${sseStats.connectTime.toFixed(2)}ms`;
                document.getElementById('comparison-connect-winner').textContent = 
                    wsStats.connectTime < sseStats.connectTime ? 'WebSocket' : 'SSE';
            }
            
            if (wsStats.latencies.length > 0 && sseStats.latencies.length > 0) {
                const wsAvgLatency = wsStats.latencies.reduce((a, b) => a + b, 0) / wsStats.latencies.length;
                const sseAvgLatency = sseStats.latencies.reduce((a, b) => a + b, 0) / sseStats.latencies.length;
                
                document.getElementById('comparison-ws-latency').textContent = `${wsAvgLatency.toFixed(2)}ms`;
                document.getElementById('comparison-sse-latency').textContent = `${sseAvgLatency.toFixed(2)}ms`;
                document.getElementById('comparison-latency-winner').textContent = 
                    wsAvgLatency < sseAvgLatency ? 'WebSocket' : 'SSE';
            }
            
            const wsStability = wsStats.sent > 0 ? ((wsStats.sent - wsStats.errors) / wsStats.sent * 100).toFixed(1) : '0';
            const sseStability = sseStats.sent > 0 ? ((sseStats.sent - sseStats.errors) / sseStats.sent * 100).toFixed(1) : '0';
            
            document.getElementById('comparison-ws-stability').textContent = `${wsStability}%`;
            document.getElementById('comparison-sse-stability').textContent = `${sseStability}%`;
            document.getElementById('comparison-stability-winner').textContent = 
                parseFloat(wsStability) > parseFloat(sseStability) ? 'WebSocket' : 'SSE';
            
            const wsReconnectRate = wsStats.reconnects > 0 ? (wsStats.reconnects / (wsStats.reconnects + 1) * 100).toFixed(1) : '100';
            const sseReconnectRate = sseStats.reconnects > 0 ? (sseStats.reconnects / (sseStats.reconnects + 1) * 100).toFixed(1) : '100';
            
            document.getElementById('comparison-ws-reconnect').textContent = `${wsReconnectRate}%`;
            document.getElementById('comparison-sse-reconnect').textContent = `${sseReconnectRate}%`;
            document.getElementById('comparison-reconnect-winner').textContent = 
                parseFloat(wsReconnectRate) > parseFloat(sseReconnectRate) ? 'WebSocket' : 'SSE';
        }, 1000);

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•é€»è¾‘
        });
    </script>
</body>
</html>